---
title: Documentation Haut parleur
title_expanded: Documentation Haut parleur
categories: [ "Structure" ]
subCategories: [ "Subcategory Name" ]
---
// PAGE TITLE
= Documentation Haut parleur



// OVERVIEW SECTION STARTS
[#overview]
--

[float]
=== Description
Le haut parleur joue différents sons en fonction des données qu'il reçoit en Bluetooth. Il y a un son pour un taux de gaz trop élevé, un son pour indiquer qu'une personne est entrée ou qu'une fenêtre est ouverte par exemple
[%hardbreaks]

image::M5Stack.jpg[caption="", title="M5Stack classique"]
[%hardbreaks]


[float]
=== Setup
`void setup()`

[#howtouse]
--

[float]
=== Code Setup
Initialisation du M5Stack et du Bluetooth

[source,arduino]
----
  // Initialize the M5Stack object
  M5.begin();
  M5.Power.begin();
  //Initialise le BT 
  SerialBT.begin("Haut_parleur_BT"); //Bluetooth device name
----
[%hardbreaks]

[float]
=== Loop
`void loop()`

[#howtouse]
--

[float]
=== Code Loop
Programme qui tourne en permanance sur le M5Stack. En fonction de ce qui est reçus. Il y a un son différent qui est joué 

[source,arduino]
----
  M5.Lcd.setCursor(0, 0, 2);
  M5.Lcd.printf("Haut parleur:\r\n");
  M5.Lcd.setCursor(0, 20, 2);
  if (SerialBT.available())
  {
    Serial.println(SerialBT.readString());
  }
  //Reception d'alerte lorsqu'une personne est rentré 
  if(SerialBT.readString()=="PirEntreeBL")
  {
    //Incrémentation du compteur
    cptPersonnes++;
    M5.Speaker.tone(NOTE_DH3, 200); //frequency 3000, with a duration of 200ms
  }
  //Reception d'alerte lorsqu'une personne est sortie 
  if(SerialBT.readString()=="PirSortieBL")
  {
    //reduit valeur du compteur 
    cptPersonnes--;
    M5.Speaker.tone(NOTE_DL3, 200); //frequency 3000, with a duration of 200ms
  }
  //Réception de l'alerte pour le taux de gaz 
  if(SerialBT.readString()=="GazAlerte")
  {
    M5.Speaker.tone(NOTE_D1, 200); //frequency 3000, with a duration of 200ms
  }
  //Pour ne pas avoir d'affichage comme "Il y a -5 personnes " 
  if(cptPersonnes < 0){
    M5.Lcd.printf("Il y a 0 personnes");
  }else{
    sprintf(result,"Il y a %d personnes", cptPersonnes);
    M5.Lcd.printf(result);
  }
  M5.update();
----
[%hardbreaks]

--
[#see_also]
--

[float]
=== Voir d'autres documentations

[role="language"]
* #LIEN :# link:https://github.com/LENSAlex/ProjetIotia/blob/Code_Capteur/documentation/DocumentationPorte.adoc[Documentation Porte]
* #LIEN :# link:https://github.com/LENSAlex/ProjetIotia/blob/Code_Capteur/documentation/DocumentationGaz.adoc[Documentation détecteur de Gaz]
* #LIEN :# link:https://github.com/LENSAlex/ProjetIotia/blob/Code_Capteur/documentation/DocumentationPIR.adoc[Documentation PIR Entrée]
* #LIEN :# link:https://github.com/LENSAlex/ProjetIotia/blob/Code_Capteur/documentation/DocumentationPIR_sortie.adoc[Documentation PIR Sortie]


